{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Flex%20Velozz%20TI/Documents/GitHub/SLA-VELOZZ/components/charts-section.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useRef, useState } from 'react'\r\nimport { Card } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { X, Download, TrendingDown } from 'lucide-react'\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'\r\n\r\ninterface ChartsSectionProps {\r\n  data: any[]\r\n  onClose: () => void\r\n}\r\n\r\nexport function ChartsSection({ data, onClose }: ChartsSectionProps) {\r\n  const sellerDelays = data.reduce((acc, row) => {\r\n    if (!acc[row.vendedor]) {\r\n      acc[row.vendedor] = { vendedor: row.vendedor, atrasos: 0, total: 0, totalDiasAtraso: 0 }\r\n    }\r\n    acc[row.vendedor].total++\r\n    if (row.status === 'Atrasado') {\r\n      acc[row.vendedor].atrasos++\r\n      acc[row.vendedor].totalDiasAtraso += row.dias\r\n    }\r\n    return acc\r\n  }, {} as Record<string, any>)\r\n\r\n  const chartData = Object.values(sellerDelays)\r\n    .map((seller: any) => ({\r\n      vendedor: seller.vendedor,\r\n      atrasos: seller.atrasos,\r\n      noPrazo: seller.total - seller.atrasos,\r\n      percentual: Math.round((seller.atrasos / seller.total) * 100),\r\n      mediaDias: seller.atrasos > 0 ? Math.round(seller.totalDiasAtraso / seller.atrasos) : 0\r\n    }))\r\n    .sort((a, b) => b.percentual - a.percentual)\r\n\r\n  const chartRef = useRef<HTMLDivElement | null>(null)\r\n  const [exporting, setExporting] = useState(false)\r\n\r\n  const handleExport = async (format: 'png' | 'pdf') => {\r\n    if (!chartRef.current) return\r\n    try {\r\n      setExporting(true)\r\n      const html2canvas = (await import('html2canvas')).default\r\n      const canvas = await html2canvas(chartRef.current, { scale: 2, useCORS: true, backgroundColor: null })\r\n      const dataUrl = canvas.toDataURL('image/png')\r\n\r\n      if (format === 'png') {\r\n        const a = document.createElement('a')\r\n        a.href = dataUrl\r\n        a.download = `grafico_atrasos_${Date.now()}.png`\r\n        document.body.appendChild(a)\r\n        a.click()\r\n        a.remove()\r\n      } else {\r\n        const { jsPDF } = await import('jspdf')\r\n        const pdf = new jsPDF({ orientation: 'landscape' })\r\n        const imgProps = pdf.getImageProperties(dataUrl)\r\n        const pdfWidth = pdf.internal.pageSize.getWidth()\r\n        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width\r\n        pdf.addImage(dataUrl, 'PNG', 0, 0, pdfWidth, pdfHeight)\r\n        pdf.save(`grafico_atrasos_${Date.now()}.pdf`)\r\n      }\r\n    } catch (err) {\r\n      // graceful fallback\r\n      console.error('Export failed', err)\r\n      alert('Falha ao exportar. Verifique o console para mais detalhes.')\r\n    } finally {\r\n      setExporting(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <section className=\"fixed inset-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80 animate-in fade-in duration-300\">\r\n      <div className=\"container mx-auto px-4 py-8 h-full overflow-y-auto\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          <div className=\"flex justify-between items-center mb-8\">\r\n            <div>\r\n              <h2 className=\"text-3xl font-bold mb-2 flex items-center gap-3\">\r\n                <TrendingDown className=\"w-8 h-8 text-destructive\" />\r\n                Análise de Atrasos\r\n              </h2>\r\n              <p className=\"text-muted-foreground\">\r\n                Ranking automático e percentual de vendedores com mais atrasos\r\n              </p>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"hover:bg-destructive/10\">\r\n              <X className=\"w-5 h-5\" />\r\n            </Button>\r\n          </div>\r\n\r\n          <div ref={chartRef} className=\"grid md:grid-cols-2 gap-6 mb-8\">\r\n            <Card className=\"p-6 shadow-lg\">\r\n              <h3 className=\"font-semibold mb-4 text-lg\">Atrasos por Vendedor</h3>\r\n              <ResponsiveContainer width=\"100%\" height={300}>\r\n                <BarChart data={chartData}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" opacity={0.3} />\r\n                  <XAxis \r\n                    dataKey=\"vendedor\" \r\n                    className=\"text-xs\" \r\n                    angle={-45}\r\n                    textAnchor=\"end\"\r\n                    height={80}\r\n                  />\r\n                  <YAxis />\r\n                  <Tooltip \r\n                    contentStyle={{ \r\n                      backgroundColor: 'hsl(var(--background))',\r\n                      border: '1px solid hsl(var(--border))',\r\n                      borderRadius: '8px',\r\n                      boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\r\n                    }}\r\n                  />\r\n                  <Legend />\r\n                  <Bar dataKey=\"atrasos\" fill=\"#ef4444\" name=\"Atrasos\" radius={[4, 4, 0, 0]} />\r\n                  <Bar dataKey=\"noPrazo\" fill=\"#22c55e\" name=\"No Prazo\" radius={[4, 4, 0, 0]} />\r\n                </BarChart>\r\n              </ResponsiveContainer>\r\n            </Card>\r\n\r\n            <Card className=\"p-6 shadow-lg\">\r\n              <h3 className=\"font-semibold mb-4 text-lg\">Ranking - Vendedores com Mais Atrasos</h3>\r\n              <div className=\"space-y-4\">\r\n                {chartData.slice(0, 5).map((seller, index) => (\r\n                  <div key={seller.vendedor} className=\"space-y-2\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm ${\r\n                          index === 0 ? 'bg-red-500 text-white' :\r\n                          index === 1 ? 'bg-orange-500 text-white' :\r\n                          index === 2 ? 'bg-amber-500 text-white' :\r\n                          'bg-muted text-muted-foreground'\r\n                        }`}>\r\n                          {index + 1}\r\n                        </div>\r\n                        <div>\r\n                          <span className=\"font-semibold\">{seller.vendedor}</span>\r\n                          <p className=\"text-xs text-muted-foreground\">\r\n                            {seller.atrasos} atrasos de {seller.atrasos + seller.noPrazo} registros\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <span className={`text-sm font-bold ${\r\n                          seller.percentual > 50 ? 'text-red-600 dark:text-red-400' : \r\n                          seller.percentual > 30 ? 'text-orange-600 dark:text-orange-400' :\r\n                          'text-amber-600 dark:text-amber-400'\r\n                        }`}>\r\n                          {seller.percentual}%\r\n                        </span>\r\n                        {seller.mediaDias > 0 && (\r\n                          <p className=\"text-xs text-muted-foreground\">\r\n                            Média: {seller.mediaDias}d\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\r\n                      <div \r\n                        className={`h-full transition-all duration-500 ${\r\n                          seller.percentual > 50 ? 'bg-gradient-to-r from-red-500 to-red-600' :\r\n                          seller.percentual > 30 ? 'bg-gradient-to-r from-orange-500 to-orange-600' :\r\n                          'bg-gradient-to-r from-amber-500 to-amber-600'\r\n                        }`}\r\n                        style={{ width: `${seller.percentual}%` }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </Card>\r\n          </div>\r\n\r\n          <div className=\"flex justify-center gap-3\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => handleExport('png')}\r\n              className=\"gap-2 hover:bg-primary hover:text-primary-foreground transition-colors\"\r\n              disabled={exporting}\r\n            >\r\n              <Download className=\"w-4 h-4\" />\r\n              {exporting ? 'Exportando...' : 'Exportar PNG'}\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => handleExport('pdf')}\r\n              className=\"gap-2 hover:bg-primary hover:text-primary-foreground transition-colors\"\r\n              disabled={exporting}\r\n            >\r\n              <Download className=\"w-4 h-4\" />\r\n              {exporting ? 'Exportando...' : 'Exportar PDF'}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}